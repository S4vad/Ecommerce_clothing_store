<%- include("./layouts/main"); -%>
<%- include("./layouts/header"); -%>
<%- include('./layouts/carticon'); -%>

<!-- breadcrumb -->
<section class="bg-img1 txt-center p-lr-15 p-tb-40" style="background-image: url('/user/images/bg-01.jpg'); margin-top: 80px;">
    <h2 class="ltext-105 cl0 txt-center">
        My Account<br><span></span>
    </h2>
</section> 

<div class="container" style="margin-top: 10px;">
    <div class="bread-crumb flex-w p-l-5 p-r-15 p-t-30 p-lr-0-lg">
        <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
            Home
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
        </a>

        <span class="stext-109 cl4">
            Shopping Cart
        </span>
    </div>
</div>

<div class="page-content" style="margin-top: 30px; min-height:60vh;">
    <div class="dashboard">
        <div class="container">
            <div class="row">
                <aside class="col-md-4 col-lg-3">
                    <ul class="nav nav-dashboard flex-column mb-3 mb-md-0" role="tablist" style="background-color: rgb(244, 244, 238);">
                        <li class="nav-item">
                            <a class="nav-link active text-dark" id="tab-dashboard-link" data-toggle="tab" href="#tab-dashboard" role="tab" aria-controls="tab-dashboard" aria-selected="true">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" id="tab-orders-link" data-toggle="tab" href="#tab-orders" role="tab" aria-controls="tab-orders" aria-selected="false">Orders</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" id="tab-address-link" data-toggle="tab" href="#tab-address" role="tab" aria-controls="tab-address" aria-selected="false">Addresses</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" id="tab-account-link" data-toggle="tab" href="#tab-account" role="tab" aria-controls="tab-account" aria-selected="false">Account Details</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-danger" href="#">Sign Out</a>
                        </li>
                    </ul>
                </aside>

                <div class="col-md-8 col-lg-9">
                    <div class="tab-content">
                        <!-- Dashboard tab pane -->
                        <div class="tab-pane fade show active" id="tab-dashboard" role="tabpanel" aria-labelledby="tab-dashboard-link">
                            <p>Welcome to your Dashboard!</p>
                            <p>Here you can view your recent activity, check your orders, and manage account details.</p>
                        </div>

                        <!-- Orders tab pane -->
                        <div class="tab-pane fade" id="tab-orders" role="tabpanel" aria-labelledby="tab-orders-link">
                            <p>Your orders will appear here.</p>
                        </div>

                        <!-- Downloads tab pane -->
                        <div class="tab-pane fade" id="tab-downloads" role="tabpanel" aria-labelledby="tab-downloads-link">
                            <p>Your downloads will appear here.</p>
                        </div>

                        <!-- Addresses tab pane -->
                         
                        <div class="tab-pane fade" id="tab-address" role="tabpanel" aria-labelledby="tab-address-link">
                            <p>The following addresses will be used on the checkout page by default.</p>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="card card-dashboard">
                                        <div class="card-body">
                                            <p>
                                                <% if (addresses.length > 0 && addresses[0].address.length > 0) { %>
                                                    <%= addresses[0].address[0].name %><br>
                                                    <%= addresses[0].address[0].address  %><br>
                                                    <%= addresses[0].address[0].city  %><br>
                                                    <%= addresses[0].address[0].state  %><br>
                                                    <%= addresses[0].address[0].zip  %><br>
                                                    <%= addresses[0].address[0].phone %><br>
                                                    <%= addresses[0].address[0].email  %><br>
                                                <% } else { %>
                                                    <%= "default user name" %><br>
                                                    <%= "user Address" %><br>
                                                    <%= "user city" %><br>
                                                    <%= "user state" %><br>
                                                    <%= "user zip" %><br>
                                                    <%= "1234567" %><br>
                                                    <%= "add address for shipping" %><br>
                                                <% } %>
                                                <a href="/profileAddress">Edit <i class="icon-edit"></i></a>
                                            </p>
                                            
                                            
                                           
                                        </div>
                                    </div>
                                </div>

                                <!-- <div class="col-lg-6">
                                    <div class="card card-dashboard">
                                        <div class="card-body">
                                            <h3 class="card-title">Shipping Address</h3>
                                            <p>You have not set up this type of address yet.<br>
                                                <a href="/profileAddress">Edit <i class="icon-edit"></i></a>
                                            </p>
                                        </div>
                                    </div>
                                </div> -->
                            </div>
                        </div>

                        <!-- Account Details tab pane -->
                        <div class="tab-pane fade" id="tab-account" role="tabpanel" aria-labelledby="tab-account-link">
                            <form action="#" >
                                <div class="row">
                                    <div class="col-sm-6">
                                        <label>First Name *</label>
                                        <input type="text" class="form-control" required id="fname">
                                    </div>

                                    <div class="col-sm-6">
                                        <label>Last Name *</label>
                                        <input type="text" class="form-control" required id="lname">
                                    </div>
                                </div>
                                <label>Email address *</label>
                                <input type="email" class="form-control" required id="email">

                                <label>Current password (leave blank to leave unchanged)</label>
                                <input type="password" class="form-control" id="currentPassword">

                                <label>New password (leave blank to leave unchanged)</label>
                                <input type="password" class="form-control" id="newPassword1">

                                <label>Confirm new password</label>
                                <input type="password" class="form-control mb-2" id="newPassword2">

                                <button type="button" onclick="updateDetails()" class="btn btn-outline-primary-2">
                                    <span>SAVE CHANGES</span>
                                    <i class="icon-long-arrow-right"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include("./layouts/footer"); -%>
<script>
    function updateDetails(){
        // Clear previous error messages
        document.querySelectorAll('.error-message').forEach(el => el.remove());

        const fname=document.getElementById('fname').value;
        const lname=document.getElementById('lname').value;
        const email=document.getElementById('email').value;
        const currentPassword=document.getElementById('currentPassword').value;
        const newPassword1=document.getElementById('newPassword1').value;
        const newPassword2=document.getElementById('newPassword2').value;
        $.ajax({
            url:'/userDetailsUpdate',
                method:'POST',
                data: JSON.stringify({
                fname: fname,
                lname: lname,
                email: email,
                currentPassword: currentPassword,
                newPassword1: newPassword1,
                newPassword2: newPassword2
            }),
            contentType: 'application/json',
            success: function(response) {
                if (response.success) {
                    alert(response.message);
                } else {
                    // Display errors below each input field
                    const errors = response.errors;
                    if (errors) {
                        if (errors.currentPassword) {
                            showError('currentPassword', errors.currentPassword);
                        }
                        if (errors.newPassword2) {
                            showError('newPassword2', errors.newPassword2);
                        }
                    }
                }
            },
            error: function() {
                alert("An error occurred while updating details.");
            }
        });

        
    }

    function showError(inputId, message) {
        const inputField = document.getElementById(inputId);
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message text-danger';
        errorDiv.innerText = message;
        inputField.parentNode.insertBefore(errorDiv, inputField.nextSibling);
    }
</script>
<%- include("./layouts/additional"); -%>
