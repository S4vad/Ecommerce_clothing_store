<%- include('./layouts/main');-%>
<%- include('./layouts/header');-%>
        <div id="top" class="sa-app__body px-2 px-lg-4">
            <div class="container pb-6">
                <div class="py-5">
                    <div class="row g-4 align-items-center">
                        <div class="col">
                            <h1 class="h3 m-0">Dashboard</h1>
                        </div>
                        <div class="col-auto d-flex"><select class="form-select me-3">
                                <option selected="">7 October, 2021</option>
                            </select><a href="#" class="btn btn-primary">Export</a></div>
                    </div>
                </div>
                <div class="row g-4 g-xl-5">
                    <div class="col-12 col-md-4 d-flex">
                        <div class="card saw-indicator flex-grow-1"
                            data-sa-container-query="{&quot;340&quot;:&quot;saw-indicator--size--lg&quot;}">
                            <div class="sa-widget-header saw-indicator__header">
                                <h2 class="sa-widget-header__title">Total sells</h2>
                                <div class="sa-widget-header__actions">
                                    <div class="dropdown">
                                    </div>
                                </div>
                            </div>
                            <div class="saw-indicator__body">
                                <div class="saw-indicator__value">&#8377; <%=totalAmount %></div>
                                <div class="saw-indicator__delta saw-indicator__delta--rise">
                                    <div class="saw-indicator__delta-direction"></div>
                                    
                                </div>
                               
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4 d-flex">
                        <div class="card saw-indicator flex-grow-1"
                            data-sa-container-query="{&quot;340&quot;:&quot;saw-indicator--size--lg&quot;}">
                            <div class="sa-widget-header saw-indicator__header">
                                <h2 class="sa-widget-header__title">Average order value</h2>
                                <div class="sa-widget-header__actions">
                                    <div class="dropdown">
                                       
                                    </div>
                                </div>
                            </div>
                            <div class="saw-indicator__body">
                                <div class="saw-indicator__value">&#8377; <%= averageOrderValue %></div>
                                <div class="saw-indicator__delta saw-indicator__delta--fall">
                                    <div class="saw-indicator__delta-direction"></div>

                                </div>
             
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4 d-flex">
                        <div class="card saw-indicator flex-grow-1"
                            data-sa-container-query="{&quot;340&quot;:&quot;saw-indicator--size--lg&quot;}">
                            <div class="sa-widget-header saw-indicator__header">
                                <h2 class="sa-widget-header__title">Total orders</h2>
                                <div class="sa-widget-header__actions">
                                    <div class="dropdown">
                                    
                                    </div>
                                </div>
                            </div>
                            <div class="saw-indicator__body">
                                <div class="saw-indicator__value"><%= totalOrders %></div>
                                <div class="saw-indicator__delta saw-indicator__delta--rise">
                                    <div class="saw-indicator__delta-direction">
                                       </div>
                          
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-4 col-xxl-3 d-flex">
                        <div class="card flex-grow-1 saw-pulse"
                            data-sa-container-query="{&quot;560&quot;:&quot;saw-pulse--size--lg&quot;}">
                            <div class="sa-widget-header saw-pulse__header">
                                <h2 class="sa-widget-header__title">Active users</h2>
                                <div class="sa-widget-header__actions">
                                    <div class="dropdown">
                                       
                                    </div>
                                </div>
                            </div>
                            <div class="saw-pulse__counter"><%= totalUsers%></div>
          
                        </div>
                    </div>
                    <div class="col-12 col-lg-8 col-xxl-9 d-flex">
                        <div class="card flex-grow-1 saw-chart"
                             data-sa-data="<%= JSON.stringify(incomeData) %>">
                            <div class="sa-widget-header saw-chart__header">
                                <h2 class="sa-widget-header__title">Income Statistics</h2>
                                <div class="sa-widget-header__actions">
                                    <div class="dropdown">
                                       
                                       
                                    </div>
                                </div>
                            </div>
                            <!-- Placeholder for the income chart -->
                            <!-- <canvas id="incomeChart" ></canvas> -->
                        </div>
                    </div>
                    
                    <div class="col-12 col-xxl-9 d-flex">
                        <div class="card flex-grow-1 saw-table">
                            <div class="sa-widget-header saw-table__header">
                                <h2 class="sa-widget-header__title">Recent orders</h2>
                                <div class="sa-widget-header__actions">
                                    <div class="dropdown"><button type="button" class="btn btn-sm btn-sa-muted d-block"
                                            id="widget-context-menu-6" data-bs-toggle="dropdown" aria-expanded="false"
                                            aria-label="More"><svg xmlns="http://www.w3.org/2000/svg" width="3"
                                                height="13" fill="currentColor">
                                                <path
                                                    d="M1.5,8C0.7,8,0,7.3,0,6.5S0.7,5,1.5,5S3,5.7,3,6.5S2.3,8,1.5,8z M1.5,3C0.7,3,0,2.3,0,1.5S0.7,0,1.5,0 S3,0.7,3,1.5S2.3,3,1.5,3z M1.5,10C2.3,10,3,10.7,3,11.5S2.3,13,1.5,13S0,12.3,0,11.5S0.7,10,1.5,10z">
                                                </path>
                                            </svg></button>
                                        <ul class="dropdown-menu dropdown-menu-end"
                                            aria-labelledby="widget-context-menu-6">
                                            <li><a class="dropdown-item" href="#">Settings</a></li>
                                            <li><a class="dropdown-item" href="#">Move</a></li>
                                            <li>
                                                <hr class="dropdown-divider" />
                                            </li>
                                            <li><a class="dropdown-item text-danger" href="#">Remove</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="saw-table__body sa-widget-table text-nowrap">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <th>Status</th>
                                       
                                            <th>Customer</th>
                                            <th>Date</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% orders.forEach(order => { %>
                                            <tr>
                                                <td><a href="app-order.html" class="text-reset"><%= order._id %> </a></td>
                                                <td>
                                                    <div class="d-flex fs-6">
                                                        <div 
                                                            id="status" 
                                                            class="badge 
                                                                <%= order.status === 'canceled' ? 'badge-sa-danger' : '' %>
                                                                <%= order.status === 'delivered' ? 'badge-sa-success' : '' %>
                                                                <%= order.status === 'processed' ? 'badge-sa-primary' : '' %>
                                                                <%= order.status === 'shipped' ? 'badge-sa-warning' : '' %>
                                                                <%= order.status === 'Placed' ? 'badge-sa-secondary' : '' %>">
                                                            <%= order.status %>
                                                        </div>
                                                    
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <a href="app-customer.html" class="sa-symbol sa-symbol--shape--circle sa-symbol--size--md me-3"></a>
                                                        <div><%= order.user.fname %> <%= order.user.lname %></div>
                                                    </div>
                                                </td>
                                                <td><%= moment(order.createdAt).format('YYYY MMMM DD') %></td>
                                                <td><%= order.totalamount %></td>
                                            </tr>
                                        <% }) %>
                                        
                                   
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-xxl-3 d-flex">
                        <div class="card flex-grow-1 saw-chart-circle" data-sa-container-query="{&quot;600&quot;:&quot;saw-chart-circle--size--lg&quot;}">
                            <div class="sa-widget-header saw-chart-circle__header">
                                <h2 class="sa-widget-header__title">Top 5 Selling Products</h2>
                            </div>
                            <div class="saw-chart-circle__body">
                                <div class="saw-chart-circle__container">
                                    <canvas id="topProductsChart"></canvas> <!-- Canvas for Chart.js -->
                                </div>
                            </div>
                            <div class="sa-widget-table saw-chart-circle__table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th class="text-center">Quantity Sold</th>
                                            <th class="text-end">Total Revenue</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% topProducts.forEach(product => { %>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="saw-chart-circle__symbol" style="--saw-chart-circle__symbol--color:#<%= (Math.random() * 0xFFFFFF << 0).toString(16).padStart(6, '0') %>"></div>
                                                        <div class="ps-2"><%= product.name %></div>
                                                    </div>
                                                </td>
                                                <td class="text-center"><%= product.totalQuantity %></td>
                                                <td class="text-end">
                                                    <div class="sa-price">
                                                        <span class="sa-price__symbol">&#8377;</span>
                                                        <span class="sa-price__integer"><%= product.totalRevenue.toLocaleString() %></span>
                                                        <span class="sa-price__decimal">.00</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-lg-6 d-flex">
                        <div class="card flex-grow-1">
                            <div class="card-body">
                                <div class="sa-widget-header">
                                    <h2 class="sa-widget-header__title">Recent reviews</h2>
                                    <div class="sa-widget-header__actions">
                                        <div class="dropdown"><button type="button"
                                                class="btn btn-sm btn-sa-muted d-block" id="widget-context-menu-9"
                                                data-bs-toggle="dropdown" aria-expanded="false" aria-label="More"><svg
                                                    xmlns="http://www.w3.org/2000/svg" width="3" height="13"
                                                    fill="currentColor">
                                                    <path
                                                        d="M1.5,8C0.7,8,0,7.3,0,6.5S0.7,5,1.5,5S3,5.7,3,6.5S2.3,8,1.5,8z M1.5,3C0.7,3,0,2.3,0,1.5S0.7,0,1.5,0 S3,0.7,3,1.5S2.3,3,1.5,3z M1.5,10C2.3,10,3,10.7,3,11.5S2.3,13,1.5,13S0,12.3,0,11.5S0.7,10,1.5,10z">
                                                    </path>
                                                </svg></button>
                                            <ul class="dropdown-menu dropdown-menu-end"
                                                aria-labelledby="widget-context-menu-9">
                                                <li><a class="dropdown-item" href="#">Settings</a></li>
                                                <li><a class="dropdown-item" href="#">Move</a></li>
                                                <li>
                                                    <hr class="dropdown-divider" />
                                                </li>
                                                <li><a class="dropdown-item text-danger" href="#">Remove</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ul class="list-group list-group-flush">
                                <% reviews.forEach(review => { %> 
                                    <li class="list-group-item py-2">
                                        <div class="d-flex align-items-center py-3"><a href="app-product.html" class="me-4">
                                                <div class="sa-symbol sa-symbol--shape--rounded sa-symbol--size--lg">
                                                    <img src="uploads/<%= review.product.Images[0] %>" width="40" height="40"
                                                        alt="" />
                                                </div>
                                            </a>
                                            <div class="d-flex align-items-center flex-grow-1 flex-wrap">
                                                <div class="col"><a href="app-product.html"
                                                        class="text-reset fs-exact-14"><%= review.product.Name %></a>
                                                    <div class="text-muted fs-exact-13">Reviewed by <a
                                                            href="app-customer.html" class="text-reset"><%= review.user.fname %> <%= review.user.lname %></a>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-sm-auto">
                                                    <div class="sa-rating ms-sm-3 my-2 my-sm-0"
                                                        style="--sa-rating--value:0.6">
                                                        <span class="" style=" color: #f5c003">
                                                            <% for (let i = 1; i <= 5; i++) { %>
                                                              <%= (i <= review.rating) ? '★' : '☆' %>
                                                            <% } %> 
                                              
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                <% }) %>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Get topProducts data from the server-side variable
            const topProducts = JSON.parse('<%- JSON.stringify(topProducts || []) %>');

            // Prepare data for the chart
            const productNames = topProducts.map(product => product.name);
            const productQuantities = topProducts.map(product => product.totalQuantity);

            // Initialize the pie chart
            const ctx = document.getElementById('topProductsChart').getContext('2d');
            const topProductsChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: productNames,
                    datasets: [{
                        label: 'Top 5 Products',
                        data: productQuantities,
                        backgroundColor: [
                            '#ffd333', '#e62e2e', '#3377ff', '#29cccc', '#5dc728' // Customize these colors
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw; // Show product name and quantity
                                }
                            }
                        }
                    }
                }
            });
        </script>

        <script>
            // Fetch and parse chart data from the data attribute
            const incomeData = JSON.parse(document.querySelector('.saw-chart').dataset.saData);

            // Render bar chart using Chart.js or another library (example for Chart.js)
            const chartx = document.getElementById('incomeChart').getContext('2d');
            const incomeChart = new Chart(chartx, {
                type: 'bar',
                data: {
                    labels: incomeData.map(data => data.label),
                    datasets: [{
                        label: 'Monthly Income',
                        data: incomeData.map(data => data.value),
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        </script>
        <%- include('./layouts/footer');-%>
